var dnsspatialdiscovery;(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{DNS:()=>r});class r{cache={};static DNS_TYPE_ID_TO_NAME={1:"A",5:"CNAME",12:"PTR",16:"TXT",29:"LOC"};constructor(e="https://dns.google/resolve",t=true){this.dohUrl=e,this.negativeCachingEnabled=t}addRecordToCache(e,t,r){e in this.cache||(this.cache[e]={}),r.timestamp=Date.now(),this.cache[e][t]=r}getRecordFromCache(e,t){if(e in this.cache&&t in this.cache[e]){const r=this.cache[e][t];if(Date.now()-r.timestamp<1e3*r.TTL)return r;delete this.cache[e][t],0===Object.keys(this.cache[e]).length&&delete this.cache[e]}return null}async dnsLookup(e,t){if(!Object.values(r.DNS_TYPE_ID_TO_NAME).includes(t))throw new Error(`Unsupported DNS record type: ${t}. Supported types: ${Object.values(r.DNS_TYPE_ID_TO_NAME).join(", ")}`);const o=this.getRecordFromCache(e,t);if(o)return console.log(`Record found in cache: ${e} ${t}`),o.fromCache=!0,o;console.log(`Record not found in cache: ${e} ${t}`);const n=`${this.dohUrl}?name=${e}&type=${t}`;try{const o=await fetch(n,{headers:{accept:"application/dns-json"}});if(!o.ok)throw new Error("DoH request failed!");const s=await o.json();if("Answer"in s&&s.Answer.length>0)for(var a of s.Answer)if(this.addRecordToCache(e,r.DNS_TYPE_ID_TO_NAME[a.type],a),r.DNS_TYPE_ID_TO_NAME[a.type]===t)return a;if("Authority"in s&&s.Authority.length>0&&this.negativeCachingEnabled){var c=null;for(a of s.Authority)if(6===a.type){c=a;break}if(c){const r=c.data.split(" ");var i={error:"NO-ANSWER",TTL:Number(r[r.length-1])};return this.addRecordToCache(e,t,i),i}}if(this.negativeCachingEnabled)throw new Error("No answer or authority found in response!")}catch(e){return`ERROR: ${e.message}`}}}dnsspatialdiscovery=t})();